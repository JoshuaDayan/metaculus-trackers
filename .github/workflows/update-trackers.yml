name: Update Metaculus Trackers

on:
  schedule:
      - cron: '0 22 * * *'
        workflow_dispatch:

        jobs:
          update-data:
              runs-on: ubuntu-latest
                  steps:
                        - name: Checkout repository
                                uses: actions/checkout@v4

                                      - name: Set up Python
                                              uses: actions/setup-python@v5
                                                      with:
                                                                python-version: '3.11'

                                                                      - name: Install dependencies
                                                                              run: pip install requests beautifulsoup4 lxml

                                                                                    - name: Run update script
                                                                                            run: python scripts/update-data.py

                                                                                                  - name: Check for changes
                                                                                                          id: git-check
                                                                                                                  run: git diff --exit-code || echo "changes=true" >> $GITHUB_OUTPUT
                                                                                                                  
                                                                                                                        - name: Commit and push if changed
                                                                                                                                if: steps.git-check.outputs.changes == 'true'
                                                                                                                                        run: |
                                                                                                                                                  git config --local user.email "action@github.com"
                                                                                                                                                            git config --local user.name "GitHub Action"
                                                                                                                                                                      git add -A
                                                                                                                                                                                git commit -m "Auto-update tracker data $(date -u +'%Y-%m-%d %H:%M UTC')"
                                                                                                                                                                                          git push
